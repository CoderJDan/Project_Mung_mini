<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>멍 스퀘어</title>
    <link rel="icon" href="/mung/images/logo.png">
    <link rel="stylesheet" href="/mung/common/style/main_style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript"
            src="//dapi.kakao.com/v2/maps/sdk.js?appkey=60afe906424b612470250c46b5008b53"></script>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=APIKEY&libraries=services"></script>

    <script src="/mung/common/script/main_script.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" as="style" crossorigin
          href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css"/>
</head>
<body>
    <div th:fragment="mapContent">
        <div class="square-map-container">
            <h2 class="square-map-title">Location</h2>
            <div class="square-map" id="kakaoMap" style="width:100%;height:400px;"></div>
        </div>

        <script>
            var mapContainer = document.getElementById('kakaoMap'),
                mapOption = {
                    center: new kakao.maps.LatLng(37.5319516, 126.9376361),
                    level: 11,
                    draggable: false,
                    scrollwheel: false,
                    disableDoubleClick: true
                };

            var map = new kakao.maps.Map(mapContainer, mapOption);

            var positions = [
                {
                    title: '화성점',
                    latlng: new kakao.maps.LatLng(37.2113338, 127.0158177),
                    clickable: true,
                    addr: '경기도 화성시 동탄대로 123',
                    tel: '031-123-4567',
                    time: '오전 9시 ~ 오후 6시',
                    img: '/mung/images/locations/화성점.jpg'
                },
                {
                    title: '일산점',
                    latlng: new kakao.maps.LatLng(37.7226320, 126.7964829),
                    clickable: true,
                    addr: '경기도 일산시 일산로 456',
                    tel: '031-765-4321',
                    time: '오전 9시 ~ 오후 6시',
                    img: '/mung/images/locations/일산점.jpg'
                },
                {
                    title: '양주정점',
                    latlng: new kakao.maps.LatLng(37.8238975, 127.0684052),
                    clickable: true,
                    addr: '경기도 양주시 옥정로 789',
                    tel: '031-987-6543',
                    time: '오전 9시 ~ 오후 6시',
                    img: '/mung/images/locations/양주점.jpg'
                },
                {
                    title: '용인점',
                    latlng: new kakao.maps.LatLng(37.2663056, 127.1445255),
                    clickable: true,
                    addr: '경기도 용인시 용인로 101',
                    tel: '031-234-5678',
                    time: '오전 9시 ~ 오후 6시',
                    img: '/mung/images/locations/용인점.jpg'
                },
                {
                    title: '김포점',
                    latlng: new kakao.maps.LatLng(37.635589, 126.662949),
                    clickable: true,
                    addr: '경기도 김포시 김포로 202',
                    tel: '031-345-6789',
                    time: '오전 9시 ~ 오후 6시',
                    img: '/mung/images/locations/김포점.jpg'
                }
            ];

            positions.forEach(function (position) {
                var marker = new kakao.maps.Marker({
                    map: map,
                    position: position.latlng,
                    title: position.title
                });

                // 인포윈도우 생성
                var infowindow = new kakao.maps.InfoWindow({
                    content: '<div style="padding:5px;">' + position.title + '</div>'
                });

                // 마커에 마우스오버 이벤트 등록
                kakao.maps.event.addListener(marker, 'mouseover', function () {
                    infowindow.open(map, marker);
                });

                // 마커에 마우스아웃 이벤트 등록
                kakao.maps.event.addListener(marker, 'mouseout', function () {
                    infowindow.close();
                });

                // 마커 클릭 이벤트를 모달 실행으로 수정
                kakao.maps.event.addListener(marker, 'click', function () {
                    window.location.href = `/mung/map`;
                    // 모달 제목 설정
                    document.getElementById('exampleModalLabel').textContent = position.title + ' 지점';

                    // 모달 내용 설정
                    document.querySelector('.modal-body').innerHTML = `
                    <div class="location-info-container">
                        <div class="location-image">
                            <img src="${position.img}" alt="${position.title} 이미지">
                        </div>
                        <div class="location-details">
                            <h5>${position.title} 지점 정보</h5>
                            <p>주소: ${position.addr}</p>
                            <p>연락처: ${position.tel}</p>
                            <p>영업시간: ${position.time}</p>
                        </div>
                    </div>
                `;

                    // 모달 푸터 설정
                    document.querySelector('.modal-footer').innerHTML = `
                    <a href="/locations/${position.title}" class="btn btn-primary">예약 바로가기</a>
                `;

                    // 모달 표시
                    var modal = new bootstrap.Modal(document.getElementById('exampleModal'));
                    modal.show();
                });
            });

            function setDraggable(draggable) {
                // 마우스 드래그로 지도 이동 가능여부를 설정합니다
                map.setDraggable(draggable);
            }

        </script>

        <!-- Modal -->
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl modal-dialog-centered">
                <div class="modal-content custom-modal">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">Modal title</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        ...
                    </div>
                    <div class="modal-footer">
                        ...
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>